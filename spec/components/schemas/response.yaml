response_list:
  type: array
  items:
    $ref: "#/response_list_item"

response_list_item:
  allOf:
    - $ref: "#/common_properties"
    - type: object
      required:
        - id
        - answers
      properties:
        id:
          $ref: "#/id"

response:
  oneOf:
    - $ref: "#/response_all_in_one"
    - $ref: "#/response_specific_question_group"
    - $ref: "#/response_specific_question"

response_all_in_one:
  description: When survey format is all-in-one
  allOf:
    - $ref: "#/common_properties"

response_specific_question_group:
  description: When survey format is group-by-group
  allOf:
    - type: object
      required: [question_group_id]
      properties:
        question_group_id:
          $ref: "../../components/schemas/question_group.yaml#/question_group_id"
    - $ref: "#/common_properties"

response_specific_question:
  description: When survey format is question-by-question
  allOf:
    - type: object
      required: [question_id]
      properties:
        question_id:
          $ref: "../../components/schemas/question.yaml#/question_id"
    - $ref: "#/common_properties"

id:
  type: integer
  description: Survey response ID

common_properties:
  type: object
  required:
    - answers
  properties:
    submit_time:
      allOf:
        - $ref: "./types.yaml#/date_time"
        - description: Submission time
          default: now

    start_time:
      allOf:
        - $ref: "./types.yaml#/date_time"
        - description: The time responding has been started
          default: now

    end_time:
      allOf:
        - $ref: "./types.yaml#/date_time"
        - description: The time responder did the last action
          default: now

    answers:
      type: object
      description: Mappings of question IDs to the answers
      additionalProperties:
        oneOf:
          - $ref: "#/unanswered"

          - type: boolean
            description: Specific to 'Yes/no' question type

          - type: integer
            description: Specific to '5 point choice' question type
            minimum: 1
            maximum: 5

          - type: number
            description: Specific to 'Numerical input' question type

          - type: string
            description: |
              The answer text. Specific to following question types:

              - Browser detection
              - Short free text
              - Long free text
              - Huge free text
            minLength: 1

          - type: string
            description: Specific to 'Language switch' question type

          - type: string
            description: Specific to 'Gender' question type
            enum:
              - M
              - F

          - type: string
            format: date-time
            description: Specific to 'Date/time' question type

          - type: string
            description: The equation result. Specific to 'Equation' question type

          - type: array
            description: >
              The answers (i.e. choices) sorted by their rankings. Specific to Ranking question
              types. If a choice is not ranked, then it must be excluded.
            items:
              $ref: "./answer.yaml#/answer_code"

          - type: array
            description: Specific to 'File upload' question type
            minItems: 0
            maxItems: 1
            items:
              type: object
              required:
                - title
                - comment
                - size
                - name
                - extension
                - uri
                - contents
              properties:
                title:
                  type: string
                  description: User-entered file title
                comment:
                  type: string
                size:
                  type: number
                  format: double
                name:
                  type: string
                  description: The name of the file just before upload
                extension:
                  type: string
                  description: File extension (e.g. PNG)
                uri:
                  type: string
                  description: The relative URI to retrieve the file contents
                  readOnly: true
                contents:
                  allOf:
                    - $ref: "#/file_contents"
                    - writeOnly: true

          - type: object
            description: |
                The answer code. Specific to following question types:

                - Bootstrap options (buttons)
                - Bootstrap dropdown
                - Image select list (radio)
                - List (radio)
                - List (dropdown)
            required:
              - other
              - value
            properties:
              other:
                type: boolean
                description: Whether the other option is selected or not
              value:
                oneOf:
                  - $ref: "./answer.yaml#/answer_code"
                  - type: string
                    description: The value of other option when selected

          - type: object
            description: Specific to 'List with comment' question type
            properties:
              code:
                $ref: "./answer.yaml#/answer_code"
              comment:
                type: string

          - type: object
            description: |
              Mapping of each subquestion code to its answer. Specific to following question types:

              - All Arrays (e.g. 'Array, dual scale', 'Array, Yes/No/Uncertain')
              - Multiple short free texts
              - Multiple numerical input
            additionalProperties:
              oneOf:
                - $ref: "#/unanswered"

                - type: integer
                  description: Specific to 'Array, 5 point choice' question type
                  minimum: 1
                  maximum: 5

                - type: integer
                  description: Specific to 'Array, 10 point choice' question type
                  minimum: 1
                  maximum: 10

                - type: number
                  description: Specific to 'Multiple numerical input' question type

                - type: string
                  description: Specific to 'Array, Increase/Same/Decrease' question type
                  minLength: 1
                  maxLength: 1
                  enum:
                    - I
                    - S
                    - D

                - type: string
                  description: Specific to 'Array, Yes/No/Uncertain' question type
                  minLength: 1
                  maxLength: 1
                  enum:
                    - Y
                    - N
                    - U

                - type: string
                  description: Specific to 'Multiple short free texts' question type
                  minLength: 1

                - allOf:
                  - $ref: "./answer.yaml#/answer_code"
                  - description: >
                      The answer code; specific to 'Array (using flexible labels)' and
                      'Array, column' question types

                - type: array
                  description: >
                    A pair of answer codes; specific to 'Array, dual scale' question type. If the
                    question is not mandatory, then passing the first or second element as null is
                    possible.
                  minItems: 1
                  maxItems: 2
                  items:
                    oneOf:
                      - $ref: "#/unanswered"
                      - $ref: "./answer.yaml#/answer_code"

                - type: object
                  description: >
                    The key is the subquestion code with Y-scale. The value is a mapping of
                    subquestion code with X-scale to their actual values (i.e. answers).

                  additionalProperties:
                    oneOf:
                      - $ref: "#/unanswered"

                      - type: integer
                        description: Specific to 'Array, numbers' question type
                        minimum: 1
                        maximum: 10

                      - type: string
                        description: The answer text; specific to 'Array, texts' question types
                        minLength: 1

          - type: object
            description: >
              Mapping of each subquestion code to its answer. Specific to 'Multiple choice' and
              'Mulitple choice with comments' question types.

              An special key 'other' (case-sensitive) may be provided if the question's Other
              option is enabled and selected by the user.
            additionalProperties:
              type: object
              required: [is_selected]
              properties:
                selected:
                  type: boolean
                  description: Whether the subquestion is selected or not
                value:
                  type: string
                  nullable: true
                  description: >
                    The value of the other choice, if selected (i.e. must only be provided if the
                    subquestion key equals to 'other')
                comment:
                  type: string
                  nullable: true
                  description: >
                    The comment when the question type is 'Multiple choice with comments'. It
                    *must* be null when either the question type is without comments or selected
                    is false.

unanswered:
  type: 'null'
  description: >
    If question (i.e. parent question of the current subquestion) is *not* mandatory, giving a
    null value means the question was leaved unanswered.

file_contents:
  type: string
  format: byte
  description: Base64-encoded contents of the file
