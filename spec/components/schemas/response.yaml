response:
  required:
    - answers
  submit_time:
    allOf:
      - $ref: "./types.yaml#/date_time"
      - description: Submission time; defaults to current server time
  start_time:
    allOf:
      - $ref: "./types.yaml#/date_time"
      - description: The time responding has been started; defaults to current server time
  end_time:
    allOf:
      - $ref: "./types.yaml#/date_time"
      - description: The time responder did the last action; defaults to current server time

  answers:
    type: object
    description: Mappings of question IDs to the answers
    additionalProperties:
      oneOf:
        - $ref: "#/response_answer_unanswered"

        - type: integer
          description: Specific to '5 point choice' question type. Zero means no answer.
          minimum: 1
          maximum: 5

        - type: string
          description: |
            The answer code (not the value). Specific to following question types:

            - Bootstrap options (buttons)
            - Bootstrap dropdown
            - Image select list (radio)
            - List (radio)
            - List (dropdown)
            - Short free text
            - Long free text
            - Huge free text
            - Language switch
            - Yes/no
            - Gender

        - type: object
          description: Specific to 'List with comment' question type
          properties:
            code:
              $ref: "./answer.yaml#/answer_code"
            comment:
              type: string

        - type: object
          description: >
            Mapping of each subquestion code to its answer. Specific to 'Array' question types (
            e.g. 'Array, Yes/No/Uncertain', 'Array, dual scale').

          additionalProperties:
            oneOf:
              - $ref: "#/response_answer_unanswered"

              - type: integer
                description: Specific to 'Array, 5 point choice' question type
                minimum: 1
                maximum: 5

              - type: integer
                description: Specific to 'Array, 10 point choice' question type
                minimum: 1
                maximum: 10

              - type: string
                description: Specific to 'Array, Increase/Same/Decrease' question type
                minLength: 1
                maxLength: 1
                enum:
                  - I
                  - S
                  - D

              - type: string
                description: Specific to 'Array, Yes/No/Uncertain' question type
                minLength: 1
                maxLength: 1
                enum:
                  - Y
                  - N
                  - U

              - allOf:
                  - $ref: "./answer.yaml#/answer_code"
                  - description: >
                      The answer code; specific to 'Array (using flexible labels)' and 'Array,
                      column' question types

              - type: array
                description: >
                  A pair of answer codes; specific to 'Array, dual scale' question type. If the
                  related question is not mandatory, then passing an array with one or even zero
                  item(s) is possible.
                minItems: 0
                maxItems: 2
                items:
                  $ref: "./answer.yaml#/answer_code"

              - type: object
                description: >
                  The key is the subquestion code with Y-scale. The value is a mapping of
                  subquestion code with X-scale to their actual values (i.e. answers).

                additionalProperties:
                  oneOf:
                    - $ref: "#/response_answer_unanswered"

                    - type: integer
                      description: Specific to 'Array, numbers' question type
                      minimum: 1
                      maximum: 10

                    - allOf:
                      - $ref: "./answer.yaml#/answer_code"
                      - description: The answer code; specific to 'Array, texts' question types

        - type: object
          description: >
            Mapping of each subquestion to whether the subquestion (i.e. choice) is selected or
            not, and other data. Specific to 'Multiple choices' question types.

          additionalProperties:
            oneOf:
              - $ref: "#/response_answer_unanswered"

              - type: boolean
                description: >
                  Whether the subquestion is selected or not. Specific to all 'Mutliple choice'
                  question types except the 'Multiple choice with comments'.

              - type: object
                description: Specific to 'Multiple choice with comments' question type
                required: [is_selected]
                properties:
                  is_selected:
                    type: boolean
                    description: Whether the subquestion is selected or not
                  comment:
                    type: string

response_answer_unanswered:
  type: 'null'
  description: >
    If the parent question's (i.e. the one containing this subquestion) mandatory property is *not*
    set to Yes, giving a null value means the question was leaved unanswered.
